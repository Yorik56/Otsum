{% extends 'base.html.twig' %}

{% block title %}Otsum{% endblock %}

{% block body %}
        <div class="container">
            <div class="row area d-flex justify-content-center align-items-center ">
                <div class="col area col-6 d-flex justify-content-around align-items-center flex-column">
                    <h2 class="text-center">Bonjour ! </h2>
                    <h3 class="text-center">Bienvenue sur OTSUM</h3>
                    <div class="block_bouton w-50">
                        <div class="row">
                            <div class="col">
                                <a class="btn button d-block w-100" href="{{ path('hub') }}">Nouvelle Partie</a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-12 col-md-6 col">
                                <a class="btn button d-block w-100" href="{{ path('login') }}">Log in</a>
                            </div>
                            <div class="form-group col-12 col-md-6 col">
                                <a class="btn button d-block w-100" href="{{ path('app_register') }}">Sign in</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function(){
                {% if app.user is null %}
                    alert("No user logged for now!");
                {% else %}
                    /*/ Envoi d'une requête à mercure /*/
                    $.ajax({
                        method: "GET",
                        url: "{{ path('push') }}",
                        success: function(response){
                            console.log(response)
                        }
                    });
                    /*/ Inscription à mercure /*/

                    // Initialisation de l'url mercure
                    const url = new URL('http://localhost:3000/.well-known/mercure')
                    // On ajoute le "topic" correspondant aux notifications de chat
                    url.searchParams.append('topic','/accueil')
                    // On écoute les évènements provenant de mercure
                    const eventSource = new EventSource(url)
                    eventSource.onmessage = (e) => {
                        console.log(e)
                    }
                    // Désinscription à mercure
                    window.addEventListener('beforeunload', function () {
                        if(eventSource != null){
                            eventSource.close()
                        }
                    })
                {% endif %}
            });
        </script>
{% endblock %}
