{% extends 'base.html.twig' %}

{% block title %}Otsum{% endblock %}

{% block body %}
    <section class="area">
        <h2 class="text-center">Bonjour ! </h2>
        <h3 class="text-center">Bienvenue sur OTSUM</h3>
        <div class="block_bouton">
            <div class="row">
                <div class="col">
                    <a class="btn button d-block w-100" href="{{ path('hub') }}">Nouvelle Partie</a>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-12 col-md-6 col">
                    <a class="btn button d-block w-100" href="{{ path('login') }}">Log in</a>
                </div>
                <div class="form-group col-12 col-md-6 col">
                    <a class="btn button d-block w-100" href="{{ path('app_register') }}">Sign in</a>
                </div>
            </div>
        </div>
    </section>
{#        <div class="container-fluid">#}
{#            <div class="row area d-flex justify-content-center align-items-center ">#}
{#                <div class="col col-3"></div>#}
{#                <div class="col area col-6 d-flex justify-content-around align-items-center flex-column">#}
{#                    <h2 class="text-center">Bonjour ! </h2>#}
{#                    <h3 class="text-center">Bienvenue sur OTSUM</h3>#}
{#                    <div class="block_bouton w-50">#}
{#                        <div class="row">#}
{#                            <div class="col">#}
{#                                <a class="btn button d-block w-100" href="{{ path('hub') }}">Nouvelle Partie</a>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="row">#}
{#                            <div class="form-group col-12 col-md-6 col">#}
{#                                <a class="btn button d-block w-100" href="{{ path('login') }}">Log in</a>#}
{#                            </div>#}
{#                            <div class="form-group col-12 col-md-6 col">#}
{#                                <a class="btn button d-block w-100" href="{{ path('app_register') }}">Sign in</a>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="col col-3">#}
                    <div class="demande_contact_formulaire">
                        <div>
                            <img src="{{ asset('images/add_contact_png.png') }}" alt="add_contact_png">
                        </div>
                        <div>
                            {{ form_start(contact_request_form, {'attr': {'class': 'form-inline'}}) }}
                                <div class="my-custom-class-for-errors">
                                    {{ form_errors(contact_request_form) }}
                                </div>
                                {{ form_label(contact_request_form.Pseudo) }}
                                {{ form_widget(contact_request_form.Pseudo) }}
                                {{ form_widget(contact_request_form.Demander, {'attr': {'class': 'btn btn-primary'}}) }}
                            {{ form_end(contact_request_form) }}
                        </div>
                    </div>
{#                </div>#}
{#            </div>#}
{#        </div>#}
        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" style="position: absolute;top: 0;right: 0">
            <div class="toast-header">
                <strong class="mr-auto">Bootstrap</strong>
                <small>11 mins ago</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body"></div>
        </div>
        <script>
            $(document).ready(function(){
                // Si l'utilisateur est connecté
                {% if app.user %}
                    //-- Inscription a un topic mercure.
                    // Initialisation de l'Url mercure
                    const url = new URL('http://localhost:3000/.well-known/mercure')
                    // On ajoute le "topic" correspondant aux notifications de chat
                    url.searchParams.append('topic','/accueil')
                    // On ajoute le "topic" correspondant aux notifications de l'utilisateur courant
                    url.searchParams.append('topic','/accueil/notifications/demande_ajout/' + {{ app.user.id }})
                    // On écoute les évènements provenant de mercure
                    const eventSource = new EventSource(url)
                    eventSource.onmessage = (e) => {
                        if(JSON.parse(e.data).topic === '/accueil/notifications/demande_ajout/' + {{ app.user.id }}){
                            $('.toast-body').html(JSON.parse(e.data).notification)
                            $('.toast').toast({ autohide: false })
                            $('.toast').toast('show')
                        }
                    }
                    //-- Désinscription aux topics mercure
                    window.addEventListener('beforeunload', function () {
                        if(eventSource != null){
                            eventSource.close()
                        }
                    })
                    //-- Formulaire demande de contact
                    $('.demande_contact_formulaire img').on('click', function () {
                        $('.demande_contact_formulaire form').toggleClass('show')
                    })
                {% endif %}
            });
        </script>
{% endblock %}
